<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bhagavad Gita - Static Viewer</title>
    <!-- Using Tailwind CSS via CDN to match the look of the provided samples -->
	<!-- Prompt to generate this using Gemini 3 Pro trial on aistudio.google.com was:		
Here is a index.html template, the tree view of the data directory, a sample verse html page and a sample chapter html page. Please write a html / javascript front-end which can get the data from the json files stored in the data directory as per the tree view. An example json file is also attached.

	-->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar to match ease of use */
        body { scroll-behavior: smooth; }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #f97316; /* Orange */
            animation: spin 1s ease infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-yellow-100 antialiased mx-2 break-words min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-blue-800 shadow-md">
        <section class="mx-auto flex justify-between items-center p-3 max-w-[960px]">
            <h1 class="text-xl font-bold">
                <a class="flex items-center text-orange-400 hover:opacity-70" href="#/">
                    <span class="hidden min-[440px]:inline">Bhagavad&nbsp;</span>Gita
                </a>
            </h1>
            <nav class="flex gap-4 text-white">
                <a href="#/" class="hover:text-orange-300">Home</a>
                <a href="#/about" class="hover:text-orange-300">About</a>
            </nav>
        </section>
    </header>

    <!-- MAIN CONTENT CONTAINER -->
    <main id="app" class="mx-auto p-2 max-w-[960px] w-full mt-4 flex-grow">
        <!-- Content will be injected here by JavaScript -->
        <div class="flex justify-center mt-10"><div class="spinner"></div></div>
    </main>

    <!-- FOOTER -->
    <footer class="text-center p-4 text-gray-600 text-xs">
        Powered by Static JSON Data
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- CONFIGURATION ---
        const BASE_URL = './data/v1'; 
        
        // --- STATE MANAGEMENT ---
        const state = {
            chapters: [],
            authors: [],
            languages: [],
            currentChapterData: null,
            // Default commentary settings
            selectedAuthorId: 16, // Defaulting to Swami Sivananda (based on sample)
            selectedLangId: '1',   // Default language ID (assuming 1 is English based on tree view)
        };

        // --- INIT ---
        window.addEventListener('load', async () => {
            await loadGlobalData();
            handleRoute();
        });

        window.addEventListener('hashchange', handleRoute);

        // --- DATA FETCHING ---
        async function fetchJSON(path) {
            try {
                const response = await fetch(`${BASE_URL}/${path}`);
                if (!response.ok) throw new Error(`File not found: ${path}`);
                return await response.json();
            } catch (error) {
                console.error("Fetch Error:", error);
                return null;
            }
        }

        async function loadGlobalData() {
            // Load essential metadata files
            state.authors = await fetchJSON('authors.json') || [];
            // Assuming chapters.json exists based on tree view context, 
            // if not we create a mock structure for the UI to work.
            state.chapters = await fetchJSON('chapters.json');
            
            // Fallback if chapters.json is missing or empty (for demonstration)
            if(!state.chapters || state.chapters.length === 0) {
                state.chapters = Array.from({length: 18}, (_, i) => ({
                    id: i + 1,
                    name: `Chapter ${i+1}`,
                    name_translation: "Yoga Name",
                    name_transliterated: "Sanskrit Name",
                    verses_count: "Unknown"
                }));
            }
        }

        // --- ROUTING ---
        function handleRoute() {
            const hash = window.location.hash;
            const app = document.getElementById('app');
            app.innerHTML = '<div class="flex justify-center mt-10"><div class="spinner"></div></div>';

            if (!hash || hash === '#/') {
                renderHome();
            } else if (hash.startsWith('#/chapter/')) {
                const chapterId = hash.split('/')[2];
                renderChapter(chapterId);
            } else if (hash.startsWith('#/verse/')) {
                // Expecting format #/verse/7.2
                const parts = hash.split('/')[2].split('.');
                renderVerse(parts[0], parts[1]);
            } else if (hash === '#/about') {
                renderAbout();
            } else {
                renderNotFound();
            }
        }

        // --- RENDERERS ---

        // 1. HOME VIEW (Grid of Chapters)
        function renderHome() {
            const html = `
                <div class="text-center mb-6">
                    <h1 class="text-3xl font-bold text-gray-800">Bhagavad Gita</h1>
                    <p class="text-gray-600 mt-2">Select a chapter to begin reading.</p>
                </div>
                <div class="grid gap-3 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
                    ${state.chapters.map(ch => `
                        <a href="#/chapter/${ch.id}" class="block group">
                            <div class="border border-black bg-orange-400 group-hover:bg-orange-300 active:scale-95 p-4 rounded-md h-full shadow-sm transition-all">
                                <h3 class="text-lg font-bold">Chapter ${ch.id}</h3>
                                <p class="font-semibold text-white">${ch.name_translation || ''}</p>
                                <p class="text-sm italic">${ch.name_transliterated || ''}</p>
                                <p class="mt-2 text-xs font-bold text-gray-800">${ch.verses_count || '?'} verses</p>
                            </div>
                        </a>
                    `).join('')}
                </div>
            `;
            document.getElementById('app').innerHTML = html;
        }

        // 2. CHAPTER VIEW (List of Verses)
        async function renderChapter(chapterId) {
            // Re-fetch chapter specific data if needed. 
            // Usually verse.json contains all, or we calculate ranges. 
            // For this frontend, we simply generate the verse links based on count.
            
            const chapter = state.chapters.find(c => c.id == chapterId) || { verses_count: 20, name_translation: 'Chapter' }; // Fallback count
            const count = parseInt(chapter.verses_count) || 30; // Default logic if data missing
            
            let versesHtml = '';
            for(let i=1; i<=count; i++) {
                versesHtml += `
                    <div class="p-2">
                        <a href="#/verse/${chapterId}.${i}">
                            <div class="border border-black bg-orange-300 hover:bg-orange-200 active:scale-95 p-2 rounded-md w-full sm:w-32 text-center cursor-pointer transition-colors">
                                <h3 class="text-base font-semibold">Verse ${i}</h3>
                            </div>
                        </a>
                    </div>
                `;
            }

            const html = `
                <div class="mb-4">
                    <a href="#/" class="text-blue-700 hover:underline">← Back to Chapters</a>
                </div>
                <h3 class="text-center">
                    <span class="block text-xl font-bold">Chapter ${chapterId}</span>
                    <span class="block text-3xl font-bold mt-2">${chapter.name_translation || ''}</span>
                    <span class="block text-xl text-gray-600 mt-1">${chapter.name_transliterated || ''}</span>
                </h3>
                
                <h4 class="my-4 text-xl font-bold border-b border-gray-400 pb-2">${count} Verses</h4>
                
                <div class="flex flex-wrap justify-center sm:justify-start">
                    ${versesHtml}
                </div>
            `;
            document.getElementById('app').innerHTML = html;
        }

        // 3. VERSE VIEW (Complex Data Fetching)
        async function renderVerse(chapterId, verseId) {
            const app = document.getElementById('app');
            
            // 1. Fetch Core Verse Text (Sanskrit/Transliteration)
            // Assuming data/v1/verse.json contains an array of all verses
            const allVerses = await fetchJSON('verse.json');
            
            // Find specific verse (assuming structure has chapter_id and verse_number or just sequential id)
            // Note: Data structure assumption based on typical JSON APIs. 
            // If verse.json is huge, it might be keyed. We will search for a match.
            let verseData = null;
            if (allVerses) {
                verseData = allVerses.find(v => v.chapter_number == chapterId && v.verse_number == verseId);
            }
            
            // Fallback UI if verse data isn't loaded/found
            const sanskrit = verseData ? verseData.text : "Sanskrit text loading or unavailable...";
            const translit = verseData ? verseData.transliteration : "";

            // 2. Fetch Commentary/Translation based on selected Author
            // Tree path: commentaries/author{ID}/lang{ID}/chapter{ID}.json
            const authorPath = `commentaries/author${state.selectedAuthorId}/lang${state.selectedLangId}/chapter${chapterId}.json`;
            const commentaryData = await fetchJSON(authorPath);
            
            let commentaryText = "Commentary unavailable for this author/language.";
            if (commentaryData) {
                // Assuming the structure is an array of verses or object keys
                const commEntry = commentaryData.find(c => c.verse_number == verseId);
                if (commEntry) {
                    commentaryText = commEntry.text || commEntry.description || commEntry.commentary;
                }
            }

            // Generate Author Options
            const authorOptions = state.authors.map(a => 
                `<option value="${a.id}" ${a.id == state.selectedAuthorId ? 'selected' : ''}>${a.name}</option>`
            ).join('');

            const html = `
                <div class="flex justify-between items-center mb-4">
                    <a href="#/chapter/${chapterId}" class="text-blue-700 hover:underline">← Back to Chapter ${chapterId}</a>
                    <div class="flex gap-2">
                        <!-- Navigation Arrows -->
                        ${verseId > 1 ? `<a href="#/verse/${chapterId}.${parseInt(verseId)-1}" class="bg-blue-800 text-white px-3 py-1 rounded">Prev</a>` : ''}
                        <a href="#/verse/${chapterId}.${parseInt(verseId)+1}" class="bg-blue-800 text-white px-3 py-1 rounded">Next</a>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md border border-orange-200">
                    <h3 class="text-2xl font-bold text-center text-orange-600 mb-2">Chapter ${chapterId}, Verse ${verseId}</h3>
                    
                    <!-- Sanskrit -->
                    <div class="text-center my-6">
                        <p class="text-2xl sm:text-3xl font-bold leading-relaxed text-gray-800 font-serif">
                            ${sanskrit.replace(/\n/g, '<br>')}
                        </p>
                    </div>

                    <!-- Transliteration -->
                    <div class="text-center my-4">
                        <p class="text-lg italic text-gray-600">
                            ${translit.replace(/\n/g, '<br>')}
                        </p>
                    </div>
                    
                    <hr class="border-orange-300 my-6">

                    <!-- Controls -->
                    <div class="flex flex-col sm:flex-row gap-4 mb-4 bg-yellow-50 p-4 rounded-md border border-yellow-200">
                        <div class="flex-1">
                            <label class="block text-sm font-bold mb-1">Select Author/Commentary:</label>
                            <select id="authorSelect" onchange="changeAuthor(${chapterId}, ${verseId}, this.value)" class="w-full p-2 border border-gray-300 rounded">
                                ${authorOptions}
                            </select>
                        </div>
                        <div class="flex-1">
                             <label class="block text-sm font-bold mb-1">Language (ID):</label>
                             <select id="langSelect" class="w-full p-2 border border-gray-300 rounded" disabled>
                                <option>English (v1)</option>
                                <!-- Language switching logic would go here if languages.json is loaded -->
                             </select>
                        </div>
                    </div>

                    <!-- Commentary Content -->
                    <div>
                        <h4 class="text-lg font-bold text-blue-800 mb-2">Commentary / Translation</h4>
                        <div class="prose max-w-none text-gray-800 leading-7">
                            ${commentaryText}
                        </div>
                    </div>
                </div>
            `;
            
            app.innerHTML = html;
        }

        // Global function to handle dropdown change
        window.changeAuthor = function(ch, v, authorId) {
            state.selectedAuthorId = authorId;
            // Re-render to fetch new data
            renderVerse(ch, v);
        }

        function renderAbout() {
            document.getElementById('app').innerHTML = `
                <h2 class="text-2xl font-bold mb-4">About</h2>
                <p>This is a pure static HTML/JS frontend viewer for the Bhagavad Gita JSON data API.</p>
                <p class="mt-2">It reads directly from the file system structure provided in the <code>data/</code> folder.</p>
            `;
        }

        function renderNotFound() {
            document.getElementById('app').innerHTML = '<h2 class="text-xl font-bold text-red-600">404 - Page Not Found</h2>';
        }

    </script>
</body>
</html>